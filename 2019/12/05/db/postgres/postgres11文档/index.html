<!DOCTYPE HTML>
<html lang="zh-CN">

<head>
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="book">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <meta name="theme-version" content="1.2.3">
    <meta name="root" content="/">
    <link rel="dns-prefetch" href="https://zouxinjiang.github.io">
    <!--SEO-->

<meta name="keywords" content="cinyoung" />


<meta name="description" content="postgres v11 官方文档阅读笔记特点
表继承
表分割

概览安装参考 安装postgres.md
pg架构pg采用cs模式架构。服务端程序叫做postgres，其中客服端连接后服务端会..." />


<meta name="robots" content="all" />
<meta name="google" content="all" />
<meta name="googlebot" content="all" />
<meta name="verify" content="all" />
    <!--Title-->

<title>
    
    Postgres11文档 |
    
    book
</title>

<link rel="alternate" href="/atom.xml" title="book" type="application/atom+xml">


<link rel="icon" href="/favicon.ico">

    

<link rel="stylesheet" href="../../../../../../css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="../../../../../../css/font-awesome.min.css?rev=4.7.0">
<link rel="stylesheet" href="../../../../../../css/style.css?rev=@@hash">
    
<div class="hide">
    <script type="text/javascript">
    var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
    document.write(unescape("%3Cspan class='cnzz_stat_icon_1263868967 hide' %3E%3Cscript%20src%3D%22https%3A%2F%2Fs95.cnzz.com%2Fz_stat.php%3Fweb_id%3D1272564536%22%3E%3C%2Fscript%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s19.cnzz.com/z_stat.php%3Fid%3D1263868967%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
    </script>
</div>




    

</head>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->
<body>
    <header class="main-header"  >
    <div class="main-header-box">
        <a class="header-avatar" href="/" title='cinyoung'>
            <!-- <img src="../../../../../../img/avatar.jpg" alt="logo头像" class="img-responsive center-block"> -->
            <img src="https://avatars1.githubusercontent.com/u/12110265?s=460&amp;v=4" alt="logo头像" class="img-responsive center-block">
        </a>
        <div class="branding">
            <!--<h2 class="text-hide">Snippet主题,从未如此简单有趣</h2>-->
            
            <img src="../../../../../../img/branding.png" alt="Snippet 博客主题" class="img-responsive center-block">
            
        </div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                        <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="navbar-brand" href="https://zouxinjiang.github.io">
                        book</a>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                        <li role="presentation" class="text-center">
                            <a href="/"><i class="fa "></i>
                                首页</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/code"><i class="fa "></i>
                                代码</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/life/"><i class="fa "></i>
                                生活</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/archives/"><i class="fa "></i>
                                时间轴</a>
                        </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="Postgres11文档">
            
            Postgres11文档
            
        </h1>
        <div class="post-meta">
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
        </span>
    </span>
    
    
    
    <span class="fa-wrap">
        <i class="fa fa-clock-o"></i>
        <span class="date-meta">
            2019/12/05</span>
    </span>
    
    <span class="fa-wrap">
        <i class="fa fa-eye"></i>
        <span id="busuanzi_value_page_pv"></span>
    </span>
    
    
</div>
        
        
    </div>
    
    <div class="post-body post-content">
        <h1 id="postgres-v11-官方文档阅读笔记"><a href="#postgres-v11-官方文档阅读笔记" class="headerlink" title="postgres v11 官方文档阅读笔记"></a>postgres v11 官方文档阅读笔记</h1><h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><ol>
<li>表继承</li>
<li>表分割</li>
</ol>
<h2 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>参考 安装postgres.md</p>
<h3 id="pg架构"><a href="#pg架构" class="headerlink" title="pg架构"></a>pg架构</h3><p>pg采用cs模式架构。服务端程序叫做postgres，其中客服端连接后服务端会为每个连接fork一个进程。pg采用多进程模型实现并发连接。其中postgres进程是master进程，负责创建子进程，master进程将在服务器一直运行。</p>
<h3 id="访问数据库"><a href="#访问数据库" class="headerlink" title="访问数据库"></a>访问数据库</h3><p>安装pg后会自带一个客户端叫做psql。后续操作就直接使用psql进行了。</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="attribute">psql mydb</span></span></pre></td></tr></table></figure>
<p>连接指定数据库，如果不指定数据库的话，就默认连接的是当前用户同名的数据库。</p>
<p>使用psql连接时提示符会有两种：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="attr">mydb</span>=&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="attr">mydb</span>=<span class="comment">#</span></span></pre></td></tr></table></figure>
<p>第二种代表你是当前数据库的超级用户。</p>
<h3 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h3><p>在psql中直接输入sql语句，而且可以折行，psql在没遇到 分号 之前是不会结束读取输入的。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> 表名(</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    列名 类型,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    ......</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">);</span></pre></td></tr></table></figure>
<h3 id="插入一条数据"><a href="#插入一条数据" class="headerlink" title="插入一条数据"></a>插入一条数据</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> 表名 <span class="keyword">VALUES</span>(列<span class="number">1</span>数据,......);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> 表名(列名<span class="number">1.</span>.....) <span class="keyword">VALUES</span>(列<span class="number">1</span>数据......)</span></pre></td></tr></table></figure>
<p>插入数据还有一种方便的方式，就是使用copy来实现，直接将文件中的内容插入到表中</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">COPY</span><span class="bash"> 表名 FROM 文件路径</span></span></pre></td></tr></table></figure>
<h3 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> 表名;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 列名... <span class="keyword">FROM</span> 表名;</span></pre></td></tr></table></figure>
<h3 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h3><p>实现多张表之间的连接查询。连接分为如下几类：</p>
<ul>
<li>内连接 inner join</li>
<li>自连接 表与自身相连接</li>
<li>左外连接 左表所有记录加上右边满足条件的记录。如果右边没有满足条件的记录，那么右边记录则是empty(null)</li>
<li>右外连接 右表所有记录加上左表满足条件的记录。左边如果没有满足条件的，则为empty(null)</li>
<li>全外连接 左边和右表所有记录，满足连接条件的则成为一条记录，不满足条件的单独成为一行。</li>
</ul>
<h3 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h3><p>和其他关系型数据库一样，pg也支持聚合函数，常用的有count(),sum(),max(),avg(),min()……</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">count</span>(*) <span class="keyword">FROM</span> 表名;</span></pre></td></tr></table></figure>

<h3 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> 表名 <span class="keyword">SET</span> 列名=值/表达式,...... <span class="keyword">WHERE</span> 条件;</span></pre></td></tr></table></figure>
<h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> 表名 <span class="keyword">WHERE</span> 条件;</span></pre></td></tr></table></figure>

<h3 id="高级特性"><a href="#高级特性" class="headerlink" title="高级特性"></a>高级特性</h3><h4 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h4><p>视图是一个虚拟表，在表之上创建的一个新的角度去组织原有的表结构，所以视图的数据来源于表，一般用视图来组织新的数据结构当成数据查询的源头，更新数据一般不直接操作视图。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> 视图名 <span class="keyword">AS</span> <span class="keyword">SELECT</span>语句;</span></pre></td></tr></table></figure>
<h4 id="外键"><a href="#外键" class="headerlink" title="外键"></a>外键</h4><p>一个表中的某列(外键)必须参考另一个表中的某列(常常是主键)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> a(</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">id</span> <span class="built_in">integer</span> primary <span class="keyword">key</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    a <span class="built_in">text</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> b(</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">id</span> <span class="built_in">integer</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    aid <span class="built_in">integer</span> <span class="keyword">REFERENCES</span> a(<span class="keyword">id</span>),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    b <span class="built_in">text</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">);</span></pre></td></tr></table></figure>
<h4 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h4><p>事务是数据库的一个重要组成部分。它是实现原子操作(一项任务需要多个步骤实现，而多个步骤是一个整体，要成的话每个步骤都要成功，否则一旦中间某个步骤出现失败，那么所有步骤都失败，数据库必须回滚到没有执行该任务之前的样子)的基本方式。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">操作语句......</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">SAVEPOINT</span> 临时保存点<span class="number">1</span>名字;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">ROLLBACK</span> <span class="keyword">TO</span> 需要回滚到哪个保存点的名字;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">COMMIT</span>;</span></pre></td></tr></table></figure>
<p>在事务中可以设定保存点，rollback的时候可以指定回滚到指定保存点的地方。如果没有设置保存点，直接使用ROLLBACK 而不是 ROLLBACK TO 那么就会回滚到整个事务开始之前的状态。</p>
<h4 id="窗口函数"><a href="#窗口函数" class="headerlink" title="窗口函数"></a>窗口函数</h4><p>窗口函数功能类似group这种，但是又有所区别。窗口函数不会影响最终结果的记录条数，而group by这种分组函数是要影响最终记录条数的。窗口函数配合聚合函数使用。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> depname,<span class="keyword">name</span>,salary,<span class="keyword">avg</span>(salary) <span class="keyword">OVER</span> (<span class="keyword">PARTITION</span> <span class="keyword">BY</span> depname) <span class="keyword">FROM</span> empSalary;</span></pre></td></tr></table></figure>
<p>结果:<br>depname | name | salary | avg(salary)<br>——– | —– | —- | —–<br>develop | 张三 | 200 | 300<br>develop | 李四 | 300 | 300<br>develop | 王五 | 400 | 300<br>sales | 小米 | 400 | 400<br>sales | 小明 | 400 | 400</p>
<p>如果使用的是group by，那么结果应该是下面这样:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> depname,<span class="keyword">avg</span>(salary) <span class="keyword">FROM</span> empSalary <span class="keyword">GROUP</span> <span class="keyword">BY</span> depname;</span></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>depname</th>
<th>avg(salary)</th>
</tr>
</thead>
<tbody><tr>
<td>develop</td>
<td>300</td>
</tr>
<tr>
<td>salels</td>
<td>400</td>
</tr>
</tbody></table>
<h4 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h4><p>和面向对象一样，pg支持表继承。这样就可以省略一些表的重复字段的书写。在不支持继承的数据库中，如果要定义一个城市表和一个首都表，而首都又是城市的一种，所以他们有很多相同的字段。那么在不支持继承的数据库中，如何实现的呢？</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> capitals (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">name</span> <span class="built_in">text</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    population <span class="built_in">real</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    altitude <span class="built_in">int</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    state <span class="built_in">char</span>(<span class="number">2</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> non_capitals (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">name</span> <span class="built_in">text</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    population <span class="built_in">real</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">    altitude <span class="built_in">int</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> cities <span class="keyword">AS</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">name</span>, population, altitude <span class="keyword">FROM</span> capitals</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">UNION</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">name</span>, population, altitude <span class="keyword">FROM</span> non_capitals;</span></pre></td></tr></table></figure>
<p>如果只是查询，那么这种方式没有什么不对的。但是如果要插入一个城市数据，那么就不是那么方便的了。</p>
<p>下面是pg实现这样需求的方式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> cities (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">name</span> <span class="built_in">text</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    population <span class="built_in">real</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    altitude <span class="built_in">int</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> capitals (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    state <span class="built_in">char</span>(<span class="number">2</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">) INHERITS (cities);</span></pre></td></tr></table></figure>
<p>这样captials就有了cities的字段。</p>
<h2 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h2><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><ul>
<li>所有SQL语句都是 关键字 + 标识符 + 值构成的。</li>
<li>关键字则是SQL语句中的 SELECT, UPDATE 等；标识符则是表名，列名这些带有某种指代的词；值就是人为填写的值了，比如 WHERE 条件中的常量值，UPDATE 中 SET 的值等等。</li>
<li>双引号在pg中代表将该引号阔起的部分看成一个整体。当表名或列名中含有空格时这是非常有用的。同时双引号中还允许unicode码转义，只需要在引号前面加上 “U&amp;”即可。比如 U&amp;”\0441\043B\043E\043D” </li>
</ul>
<h4 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h4><ul>
<li>字符常量。在pg中字符串常量要使用单引号阔起。如果字符串常量中含有单引号，那么就要使用两个 <strong>连续[中间空格都不能有]</strong> 的单引号，此时前一个单引号相当于转义符。比如 SELECT ‘s’’’,得到的结果是 s’。<ul>
<li>带有C风格的转义符（\）时，在单引号前添加一个E/e字母就可以让C风格转义生效</li>
<li>带有unicode转义时，在单引号前加上 U/u&amp; 即可</li>
<li>pg特有的使用$符号来充当引号。这种方式很像PHP的heredoc。例子$SomeTag$Dianne’s horse$SomeTag$  使用$$开头$$结束。其中$$之间可以加上一个名字。</li>
</ul>
</li>
<li>位字符串<ul>
<li>B’0110’</li>
<li>X’1FF’</li>
</ul>
</li>
<li>数值常量<ul>
<li>digits</li>
<li>digits.[digits][e[+-]digits]</li>
<li>[digits].digits[e[+-]digits]</li>
<li>digitse[+-]digits</li>
</ul>
</li>
<li>操作符<ul>
<li>+ - * / &lt; &gt; = ~ ! @ # % ^ &amp; | ` ?</li>
<li>-- 和 /*是注释的开始</li>
</ul>
</li>
<li>特殊符号<ul>
<li>$ 如果紧跟一个数字，那么在function内部表示的是位置参数。其他情况当成普通字符</li>
<li>() 用来将表达式分组和强制优先。</li>
<li>[] 用来选择数组的某一项值。</li>
<li>, 多项之间的分割</li>
<li>; SQL语句结束</li>
<li>: 数组切片</li>
<li>优先级， 由高到低</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>操作符</th>
<th>结合行</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>.</td>
<td>left</td>
<td>schema，表，列连接符</td>
</tr>
<tr>
<td>::</td>
<td>left</td>
<td>类型转换</td>
</tr>
<tr>
<td>[]</td>
<td>left</td>
<td>数组选择符</td>
</tr>
<tr>
<td>+ -</td>
<td>right</td>
<td>正，负</td>
</tr>
<tr>
<td>^</td>
<td>left</td>
<td>幂</td>
</tr>
<tr>
<td>* / %</td>
<td>left</td>
<td>乘 除 取余</td>
</tr>
<tr>
<td>+ -</td>
<td>left</td>
<td>加 减</td>
</tr>
<tr>
<td>其他操作符</td>
<td>left</td>
<td>其他操作符或用户自定义操作符</td>
</tr>
<tr>
<td>BETWEEN IN LIKE ILIKE SIMILAR</td>
<td>-</td>
<td>范围，集合，字符串匹配</td>
</tr>
<tr>
<td>&gt; &gt;= &lt; &lt;= = &lt;&gt;</td>
<td>-</td>
<td>比较运算符</td>
</tr>
<tr>
<td>IS ISNULL NOTNULL</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td>NOT</td>
<td>right</td>
<td>逻辑非</td>
</tr>
<tr>
<td>AND</td>
<td>left</td>
<td>逻辑与</td>
</tr>
<tr>
<td>OR</td>
<td>left</td>
<td>逻辑或</td>
</tr>
</tbody></table>
<h4 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h4><p>两种风格</p>
<ul>
<li>– 单行注释</li>
<li>/*多行注释*/</li>
</ul>
<h4 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h4><ul>
<li>CASE(表达式 AS 需要转换成的类型)————-SQL标准用法</li>
<li>类型 表达式  但这种方式只能用于简单类型，不能作用于数组等复杂类型</li>
<li>表达式::需要转换成的类型———————–pg特有用法</li>
<li>需要转换成的类型(表达式)——————–这种是使用一个function来完成的，前提是要有相应类型的转换function才行。</li>
</ul>
<h4 id="值表达式"><a href="#值表达式" class="headerlink" title="值表达式"></a>值表达式</h4><ul>
<li><p>列引用</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">表.列</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">schema.表.列</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">表.*   =&gt; 所有列</span></pre></td></tr></table></figure></li>
<li><p>位置参数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> dept(<span class="built_in">text</span>) <span class="keyword">RETURNS</span> dept</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">AS</span> $$ <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> dept <span class="keyword">WHERE</span> <span class="keyword">name</span> = $<span class="number">1</span> $$</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">LANGUAGE</span> <span class="keyword">SQL</span>;</span></pre></td></tr></table></figure>
</li>
<li><p>下标 用于数组</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">数组[下标]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">数组[下标1:下标2]   =&gt; 切片</span></pre></td></tr></table></figure>
</li>
<li><p>运算式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">表达式 运算符 表达式</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">一元运算符 表达式</span></pre></td></tr></table></figure>
</li>
<li><p>函数调用</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">函数名<span class="comment">(参数...)</span></span></pre></td></tr></table></figure>
</li>
<li><p>排序规则</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">表达式 <span class="keyword">COLLATE</span> 规则</span></pre></td></tr></table></figure>
</li>
<li><p>数组构造器</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">ARRAY[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>+<span class="number">4</span>]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">ARRAY[<span class="number">1</span>,<span class="number">2</span>,<span class="number">22.7</span>]::<span class="built_in">int</span>eger[]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">ARRAY[ARRAY[<span class="number">1</span>,<span class="number">2</span>], ARRAY[<span class="number">3</span>,<span class="number">4</span>]]</span></pre></td></tr></table></figure>
</li>
<li><p>行构造器<br>用来将数据组成新的行记录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">ROW(1,2.5,'this is a test');</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">ROW</span>(t.*, <span class="number">42</span>) <span class="keyword">FROM</span> t;</span></pre></td></tr></table></figure></li>
</ul>
<p><strong>注意</strong>：在pg 8.2之前行构造器中是不能使用 .* 表示表的所有列的。</p>
<h4 id="function的调用"><a href="#function的调用" class="headerlink" title="function的调用"></a>function的调用</h4><p>调用方式为: function名字(参数…)</p>
<ul>
<li>按位置传参  function的名字(1,2,3)</li>
<li>按名字传参  function的名字(a =&gt; 1 ,b =&gt; 2)</li>
<li>混合以上两种传参方式 function的名字(1,2,c =&gt; 3)</li>
</ul>
<p><strong>注意</strong>：混合传参方式不能在调用聚合函数使用，但是能够作用于配合窗口函数的聚合函数。</p>
<h3 id="数据定义"><a href="#数据定义" class="headerlink" title="数据定义"></a>数据定义</h3><h4 id="表"><a href="#表" class="headerlink" title="表"></a>表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建表</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> 表名(</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    列名 类型,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    ......</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 删除表</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> 表名;</span></pre></td></tr></table></figure>
<p><strong>注意</strong>：表格列数是有限制的，根据列类型不同，列数量限制在250~1600不等。</p>
<h4 id="默认值"><a href="#默认值" class="headerlink" title="默认值"></a>默认值</h4><p>创建表的时候可以给列赋予一个默认值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> products (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    product_no <span class="built_in">integer</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">name</span> <span class="built_in">text</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    price <span class="built_in">numeric</span> <span class="keyword">DEFAULT</span> <span class="number">9.99</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">);</span></pre></td></tr></table></figure>

<p>####　生成列<br>生成列不能够直接写入，在insert，update语句中不能指定该列，但是在delete时可以指定该列作为删除条件。<br>生成列的一些限制条件：</p>
<ol>
<li>不能在表达式中使用子查询或者引用其他表</li>
<li>表达式中不能引用其他生成列</li>
<li>不能有默认值和标识定义</li>
<li>生成列不能成为键的一部分</li>
</ol>
<p>生成列有两种类型</p>
<ul>
<li>stored   占据一列，在数据插入或更新时重新计算</li>
<li>virtual  不占据存储，在数据读取时重新计算<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 在创建表时指定：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 列名 类型 GENERATED ALWAYS AS 计算表达式 STORED/VIRTUAL</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> people (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    ...,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    height_cm <span class="built_in">numeric</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    height_in <span class="built_in">numeric</span> <span class="keyword">GENERATED</span> <span class="keyword">ALWAYS</span> <span class="keyword">AS</span> (height_cm / <span class="number">2.54</span>) <span class="keyword">STORED</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">);</span></pre></td></tr></table></figure>


</li>
</ul>
<h4 id="约束"><a href="#约束" class="headerlink" title="约束"></a>约束</h4><p>创建表时也可以指定列的约束。</p>
<ul>
<li>CHECK 约束<ul>
<li>示例<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 匿名</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> products (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    product_no <span class="built_in">integer</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">name</span> <span class="built_in">text</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    price <span class="built_in">numeric</span> <span class="keyword">CHECK</span> (price &gt; <span class="number">0</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 命名,挂在字段上</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> products (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    product_no <span class="built_in">integer</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">name</span> <span class="built_in">text</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">    price <span class="built_in">numeric</span> <span class="keyword">CONSTRAINT</span> positive_price  <span class="keyword">CHECK</span> (price &gt; <span class="number">0</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 单独指定字段</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> products (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">    product_no <span class="built_in">integer</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">name</span> <span class="built_in">text</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">    price <span class="built_in">numeric</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">CHECK</span>(条件)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 单独指定字段且命名</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> products (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">    product_no <span class="built_in">integer</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">name</span> <span class="built_in">text</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">    price <span class="built_in">numeric</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">CONSTRAINT</span> 名字 <span class="keyword">CHECK</span>(条件)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">);</span></pre></td></tr></table></figure></li>
</ul>
</li>
<li>非空约束 not null<ul>
<li>示例<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> products (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    product_no <span class="built_in">integer</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">name</span> <span class="built_in">text</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    price <span class="built_in">numeric</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">);</span></pre></td></tr></table></figure></li>
</ul>
</li>
<li>唯一约束 unique<ul>
<li>示例<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 直接在列上指定</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> products (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    product_no <span class="built_in">integer</span> <span class="keyword">UNIQUE</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">name</span> <span class="built_in">text</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    price <span class="built_in">numeric</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 最后再指定</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> products (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    product_no <span class="built_in">integer</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">name</span> <span class="built_in">text</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">    price <span class="built_in">numeric</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">UNIQUE</span> (product_no)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 命名</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> products (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">    product_no <span class="built_in">integer</span> <span class="keyword">CONSTRAINT</span> must_be_different <span class="keyword">UNIQUE</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">name</span> <span class="built_in">text</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">    price <span class="built_in">numeric</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 组合唯一约束。多列组成一个唯一约束</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> example (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">    a <span class="built_in">integer</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">    b <span class="built_in">integer</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">    c <span class="built_in">integer</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">UNIQUE</span> (a, c)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">);</span></pre></td></tr></table></figure></li>
</ul>
</li>
<li>主键约束。主键约束其实就是唯一约束加上非空约束。<ul>
<li>示例<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 组合主键。和组合唯一约束一样。ac作为一个整体唯一索引看待。且ac都不能为null</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> example (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    a <span class="built_in">integer</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    b <span class="built_in">integer</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    c <span class="built_in">integer</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    PRIMARY <span class="keyword">KEY</span> (a, c)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 单列主键</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> products (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    product_no <span class="built_in">integer</span> PRIMARY <span class="keyword">KEY</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">name</span> <span class="built_in">text</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">    price <span class="built_in">numeric</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">);</span></pre></td></tr></table></figure></li>
</ul>
</li>
<li>外键约束。约束该列的值一定出现在另一张表的某列中，如果另一个表中那列没有该值，那么插入到这个表就会失败。外键一定是一个表的某列参照另一个表的主键列。<ul>
<li>示例<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 指定参照products表的product_no列</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> orders (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    order_id <span class="built_in">integer</span> PRIMARY <span class="keyword">KEY</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    product_no <span class="built_in">integer</span> <span class="keyword">REFERENCES</span> products (product_no),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    quantity <span class="built_in">integer</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 组合外键</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t1 (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    a <span class="built_in">integer</span> PRIMARY <span class="keyword">KEY</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    b <span class="built_in">integer</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">    c <span class="built_in">integer</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (b, c) <span class="keyword">REFERENCES</span> other_table (c1, c2)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">);</span></pre></td></tr></table></figure></li>
<li>注意点<br /><ul>
<li>被参照的数据在删除的时候 (ON DELETE) 会报错，说不能够删除。那么就应该在外键那个表添加删除被参照数据时应该执行什么动作。<ol>
<li>删除被参考数据，那么外键对应的记录也应该被删除. (CASCADE)</li>
<li>删除被参考数据时，外键对应的记录保留，不做任何操作.</li>
<li>删除被参考数据时，外键对应的记录设置为null. (SET NULL)</li>
<li>……，外键对应的记录设置为默认值。(SET DEFAULT)</li>
<li>删除被参考数据时，不允许删除，提示该数据被xx作为外键。(默认情况 NO ACTION，即值设定外键，没有指定ON DELETE执行什么操作；RESTRICT 也是这样，不过RESTRICT不允许在事务结束后才检查约束)</li>
</ol>
</li>
<li>被参照数据在更新时(ON UPDATE).<ol>
<li>更新被参考数据，那么同步更新到外键对应记录中 (CASCADE)<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> order_items (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    product_no <span class="built_in">integer</span> <span class="keyword">REFERENCES</span> products <span class="keyword">ON</span> <span class="keyword">DELETE</span> RESTRICT,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    order_id <span class="built_in">integer</span> <span class="keyword">REFERENCES</span> orders <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">CASCADE</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    quantity <span class="built_in">integer</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    PRIMARY <span class="keyword">KEY</span> (product_no, order_id)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">);</span></pre></td></tr></table></figure>
<h4 id="系统列"><a href="#系统列" class="headerlink" title="系统列"></a>系统列</h4>系统列指的是pg数据库系统自带的列，用户自定义数据的列名不能与之冲突。</li>
</ol>
</li>
</ul>
</li>
</ul>
</li>
<li>oid<ul>
<li>表示对象id(object id)。创建表的时候使用 WITH OIDS选项或者设置了oids变量的配置时生效。</li>
</ul>
</li>
<li>tableoid<ul>
<li>表的oid。此列对于从继承层次结构中选择的查询特别有用，因为没有它，很难判断出哪一个单独的表来自哪里。tableoid可以与pg_class的oid列连接以获得表名。</li>
</ul>
</li>
<li>xmin<ul>
<li>此行版本的插入事务的标识（事务ID）。行版本是行的单独状态；行的每一次更新都为同一逻辑行创建新行版本。</li>
</ul>
</li>
<li>cmin<ul>
<li>插入事务中的命令标识符（从零开始）</li>
</ul>
</li>
<li>xmax<ul>
<li>删除事务的标识（事务ID），或未删除行版本的零。此列在可见行版本中是非零的。这通常表明删除事务尚未提交，或者尝试删除被回滚。</li>
</ul>
</li>
<li>cmax<ul>
<li>删除事务中的命令标识符，或为零。</li>
</ul>
</li>
<li>ctid<ul>
<li>行版本在其表中的物理位置。注意，虽然CTID可以很快地定位行版本，但是如果它被真空填充更新或移动，行的CTID将改变。因此CTID作为长期行标识符是无用的。应该使用OID，甚至更好的用户定义的序列号来标识逻辑行。</li>
</ul>
</li>
</ul>
<h4 id="修改表结构"><a href="#修改表结构" class="headerlink" title="修改表结构"></a>修改表结构</h4><h5 id="增加列"><a href="#增加列" class="headerlink" title="增加列"></a>增加列</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> 列名 列数据类型;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 同时制定一个约束</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> products <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> description <span class="built_in">text</span> <span class="keyword">CHECK</span> (description&lt;&gt; <span class="string">''</span>);</span></pre></td></tr></table></figure>
<p><strong>注意</strong>：如果增加的列指定了默认值。数据库会物理更新每一条数据，所以如果你添加的列有默认值，但是有要让某些记录不会被更新为默认值，那么你创建该列时就要创建一个没有默认值的列，然后手动update。</p>
<h5 id="移除某列"><a href="#移除某列" class="headerlink" title="移除某列"></a>移除某列</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">DROP</span> <span class="keyword">COLUMN</span> 列名;</span></pre></td></tr></table></figure>
<p>如果该列被某个外键参考了，那么用上面这种方式是删不掉的。于是需要使用到CASCADE，强制删除。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> products <span class="keyword">DROP</span> <span class="keyword">COLUMN</span> description <span class="keyword">CASCADE</span>;</span></pre></td></tr></table></figure>
<h5 id="添加约束"><a href="#添加约束" class="headerlink" title="添加约束"></a>添加约束</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> products <span class="keyword">ADD</span> <span class="keyword">CHECK</span> (<span class="keyword">name</span> &lt;&gt; <span class="string">''</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> products <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> some_name <span class="keyword">UNIQUE</span> (product_no);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> products <span class="keyword">ADD</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (product_group_id) <span class="keyword">REFERENCES</span> product_groups;</span></pre></td></tr></table></figure>
<h5 id="删除约束"><a href="#删除约束" class="headerlink" title="删除约束"></a>删除约束</h5><p>选表-&gt;选列-&gt;删约束</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> products <span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> product_no <span class="keyword">DROP</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>;</span></pre></td></tr></table></figure>
<h5 id="修改列默认值"><a href="#修改列默认值" class="headerlink" title="修改列默认值"></a>修改列默认值</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> products <span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> price <span class="keyword">SET</span> <span class="keyword">DEFAULT</span> <span class="number">7.77</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> products <span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> price <span class="keyword">DROP</span> <span class="keyword">DEFAULT</span>;</span></pre></td></tr></table></figure>
<h5 id="修改列类型定义"><a href="#修改列类型定义" class="headerlink" title="修改列类型定义"></a>修改列类型定义</h5><p>选表-&gt;选列-&gt;修改定义</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> products <span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> price <span class="keyword">TYPE</span> <span class="built_in">numeric</span>(<span class="number">10</span>,<span class="number">2</span>);</span></pre></td></tr></table></figure>
<h5 id="修改列名"><a href="#修改列名" class="headerlink" title="修改列名"></a>修改列名</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> products <span class="keyword">RENAME</span> <span class="keyword">COLUMN</span> product_no <span class="keyword">TO</span> product_number;</span></pre></td></tr></table></figure>
<h5 id="修改表名"><a href="#修改表名" class="headerlink" title="修改表名"></a>修改表名</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> products <span class="keyword">RENAME</span> <span class="keyword">TO</span> items;</span></pre></td></tr></table></figure>

<h4 id="权限"><a href="#权限" class="headerlink" title="权限"></a>权限</h4><ul>
<li>修改表拥有者<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="built_in">table_name</span> <span class="keyword">OWNER</span> <span class="keyword">TO</span> new_owner</span></pre></td></tr></table></figure></li>
<li>该用户赋予权限<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">UPDATE</span> <span class="keyword">ON</span> accounts <span class="keyword">TO</span> joe</span></pre></td></tr></table></figure></li>
<li>移除权限<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">ALL</span> <span class="keyword">ON</span> accounts <span class="keyword">FROM</span> <span class="built_in">PUBLIC</span></span></pre></td></tr></table></figure>





</li>
</ul>
<h4 id="schema"><a href="#schema" class="headerlink" title="schema"></a>schema</h4><p>目的:</p>
<ol>
<li>允许在一个数据库中，不需要一一指定用户就能共享一张表。</li>
<li>可按逻辑对数据表进行分组，增加管理便利性。</li>
<li>可将第三方应用的数据库表放入另一个schema中，避免和自己的数据库表冲突。</li>
</ol>
<p>schema做了除用户以外的相互隔离。可以将schema看成一个子数据库。</p>
<p>每个数据库中默认有一个public的schema，这个是在执行sql时不指定schema的默认schema。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">SCHEMA</span> myschema;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> myschema.mytable (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">...</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 如果不指定schema那么创建的表就在默认的schema (public)中</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> products ( ... );</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> public.products ( ... );</span></pre></td></tr></table></figure>
<h5 id="删除空schema"><a href="#删除空schema" class="headerlink" title="删除空schema"></a>删除空schema</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">SCHEMA</span> myschema;</span></pre></td></tr></table></figure>
<h4 id="强制删除schema"><a href="#强制删除schema" class="headerlink" title="强制删除schema"></a>强制删除schema</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">SCHEMA</span> myschema <span class="keyword">CASCADE</span>;</span></pre></td></tr></table></figure>

<h4 id="搜索路径"><a href="#搜索路径" class="headerlink" title="搜索路径"></a>搜索路径</h4><p>当执行一条sql语句时，系统如何查找到指定的对象。通过 show search_path 就可以看到当前语句中的对象(表等等)查找schema顺序。排在前的有限搜索，$user表示跟当前用户同名的schema。</p>
<h4 id="继承-1"><a href="#继承-1" class="headerlink" title="继承"></a>继承</h4><p>pg提供了表继承的特性。<br>特点:</p>
<ul>
<li>在子表插入数据时，默认情况会在父表中也插入一条数据。</li>
<li>查询父表中的所有数据时，默认将插入子表时插入的记录也会出现在结果集中。(就是普通的select)</li>
<li>如果只想在父表中查询到哪些非插入字表而插入的记录时，可以使用ONLY关键字。</li>
<li>有了继承关系，表就有了tableoid字段。</li>
<li>约束继承只会继承非空约束，默认是会继承非空约束的，除非特别指明。其他类型的约束是不会继承的。</li>
<li>继承可以继承一个或多个表。如果所有父表以及子表中字段名字冲突，则要合并这些同名列。要想成功合并，那么就需要相同的数据类型而且有相同的约束。这里的约束就单指非空约束了，因为继承只会继承非空约束。</li>
<li>两个表之间建立继承关系有两种方式。1 是在创建表的时候使用 INHERITS 指定。 2 是在两个表创建之后使用 ALTER TABLE 再建立继承关系。前提是这两个表构成继承关系条件。</li>
</ul>
<p>示例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">"A"</span>(</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="string">"Name"</span> <span class="built_in">text</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">"B"</span>(</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    <span class="string">"Describe"</span> <span class="built_in">text</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">) INHERITS(<span class="string">"A"</span>);</span></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询A中所有的数据</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="string">"A"</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 和上等价</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="string">"A"</span>*;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 只查不是因为向B插入数据而增加的记录</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">ONLY</span> <span class="string">"A"</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询记录所属的tableoid。 这样你就能看到哪些数据只属于这个表。</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> tableoid,<span class="string">"Name"</span> <span class="keyword">from</span> <span class="string">"A"</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查找记录所属表名，而不只是tableoid</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> p.relname,a.tableoid,<span class="string">"Name"</span> <span class="keyword">from</span> <span class="string">"A"</span> a,pg_class p <span class="keyword">where</span> a.tableid=p.oid;</span></pre></td></tr></table></figure>

<h4 id="表的分割"><a href="#表的分割" class="headerlink" title="表的分割"></a>表的分割</h4><h4 id="依赖跟踪"><a href="#依赖跟踪" class="headerlink" title="依赖跟踪"></a>依赖跟踪</h4><p>在类似外键约束这种情况下，删除被依赖的数据默认情况下是不允许的。通过给出的错误信息中的DETAIL信息你就能看到该数据的依赖关系。如果想要强制删除也是可以的，那么在DROP最后加上CASCADE就可以了，几乎所有的DROP语句都支持CASCADE。你可以使用RESTRICT代替CASCADE，那么就会严格进行依赖检查，和默认不写CASCADE的行为一样。</p>
<p><strong>注意</strong>：在SQL标准中CASCADE和RESTRICT是必须出现在DROP语句中的，只是默认情况(不填这两个单词)到底是CASCADE还是RESTRICT根据数据库系统而有所区别。</p>
<h3 id="数据操纵"><a href="#数据操纵" class="headerlink" title="数据操纵"></a>数据操纵</h3><h4 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 所有列</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> products <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">'Cheese'</span>, <span class="number">9.99</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 指定列</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> products (product_no, <span class="keyword">name</span>, price) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">'Cheese'</span>,<span class="number">9.99</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- PG扩展格式。 从左往右赋值，右边没有赋值到的字段使用默认值。</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> products <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">'Cheese'</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 多行插入</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> products (product_no, <span class="keyword">name</span>, price) <span class="keyword">VALUES</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">(<span class="number">1</span>, <span class="string">'Cheese'</span>, <span class="number">9.99</span>),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">(<span class="number">2</span>, <span class="string">'Bread'</span>, <span class="number">1.99</span>),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">(<span class="number">3</span>, <span class="string">'Milk'</span>, <span class="number">2.99</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 用其他表数据作为插入数据源</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> products (product_no, <span class="keyword">name</span>, price)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> product_no, <span class="keyword">name</span>, price <span class="keyword">FROM</span> new_products</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">WHERE</span> release_date = <span class="string">'today'</span>;</span></pre></td></tr></table></figure>

<h4 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h4><p>语句分为三部分:</p>
<ul>
<li>要更新的表</li>
<li>要更新的列以及新值</li>
<li>要更新哪些记录(条件)</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 常量值</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> products <span class="keyword">SET</span> price = <span class="number">10</span> <span class="keyword">WHERE</span> price = <span class="number">5</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 表达式</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> products <span class="keyword">SET</span> price = price * <span class="number">1.10</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 多列</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> mytable <span class="keyword">SET</span> a = <span class="number">5</span>, b = <span class="number">3</span>, c = <span class="number">1</span> <span class="keyword">WHERE</span> a &gt; <span class="number">0</span>;</span></pre></td></tr></table></figure>

<h4 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 删除满足条件的记录</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> price = <span class="number">10</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 删除所有数据</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> products;</span></pre></td></tr></table></figure>

<h4 id="操纵数据的同时返回数据表-RETURNING"><a href="#操纵数据的同时返回数据表-RETURNING" class="headerlink" title="操纵数据的同时返回数据表(RETURNING)"></a>操纵数据的同时返回数据表(RETURNING)</h4><p>通过标题理解起来肯定费解。通过例子你就能恍然大悟了。在我们insert数据到表后，往往我们需要我们刚刚插入的数据的id是好多。此时使用这个东西就能在插入数据后将id返回给我们。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 返回一个字段</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">users</span> (firstname, lastname) <span class="keyword">VALUES</span> (<span class="string">'Joe'</span>, <span class="string">'Cool'</span>) <span class="keyword">RETURNING</span> <span class="keyword">id</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 返回多个字段</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> products <span class="keyword">SET</span> price = price * <span class="number">1.10</span> <span class="keyword">WHERE</span> price &lt;= <span class="number">99.99</span> <span class="keyword">RETURNING</span> <span class="keyword">name</span>, price <span class="keyword">AS</span> new_price;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 返回所有字段</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> obsoletion_date = <span class="string">'today'</span> <span class="keyword">RETURNING</span> *;</span></pre></td></tr></table></figure>
<p>RETURNING * 指代表的所有字段，无需一个一个字段罗列出来</p>
<h3 id="查询-1"><a href="#查询-1" class="headerlink" title="查询"></a>查询</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">[<span class="keyword">WITH</span> with_queries] <span class="keyword">SELECT</span> select_list <span class="keyword">FROM</span> table_expression [sort_specification]</span></pre></td></tr></table></figure>
<h4 id="表表达式"><a href="#表表达式" class="headerlink" title="表表达式"></a>表表达式</h4><ul>
<li><p>FROM。  FROM 表名1 [,表名2……]</p>
</li>
<li><p>JOIN。 表1 join类型 表2 [join条件]</p>
<ul>
<li><p>join类型分为：</p>
<ol>
<li>[INNER] JOIN</li>
<li>LEFT [OUTER] JOIN</li>
<li>RIGHT [OUTER] JOIN</li>
<li>FULL [OUTER] JOIN</li>
</ol>
</li>
<li><p>条件<br>  1。 ON 布尔表达式。  使用布尔表达式作为条件。结果中会出现来自两个表的所有列(<strong>包含”同名” 列</strong>)。</p>
<ol start="2">
<li>USING (列名,….)。 使用两表相同列名做等值连接。但是结果里面<strong>不会出现 “同名” 列</strong>。</li>
<li></li>
</ol>
</li>
<li><p>说明</p>
<ol>
<li>内连接。只显示满足条件的记录</li>
<li>左外。显示左表所有记录，右表只显示满足条件的记录。不满足条件的字段为null值。最后结果记录数为左表的记录数。</li>
<li>右外。显示右表所有记录，左表只显示满足条件的记录。不满足条件的字段为null值。最后结果记录数为右表的记录数。</li>
<li>全外。 显示左右两表所有记录，满足条件的则成为结果的一条记录。不满足条件的则要么左表字段为null，要么右表字段为null。结果记录数为左右两表记录数总和减去左右两表满足条件的记录数。</li>
</ol>
</li>
</ul>
</li>
<li><p>带别名。 FROM 表名 [AS] 别名</p>
</li>
<li><p>子查询。 FROM (SELECT * FROM table1) AS alias_name</p>
<ul>
<li>LATERAL关键字，能够让子查询能够引用到子查询以外的表<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> a, <span class="keyword">LATERAL</span> (<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> b <span class="keyword">WHERE</span> b.id=a.id)</span></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>表函数 function<br>表函数返回一个标量或返回表记录。使用表函数时可以把函数当成一个子查询来使用。可以使用select，join，where条件等。</p>
</li>
</ul>
<h4 id="where条件句"><a href="#where条件句" class="headerlink" title="where条件句"></a>where条件句</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">WHERE search_condition</span></pre></td></tr></table></figure>
<h4 id="group-by-和-having"><a href="#group-by-和-having" class="headerlink" title="group by 和 having"></a>group by 和 having</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> select_list</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ...</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">[<span class="keyword">WHERE</span> ...]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> grouping_column_reference</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">[, grouping_column_reference]...</span></pre></td></tr></table></figure>
<p>having是对分组后的数据再进行一次过滤。</p>
<p>Group By中可SELECT可以使用聚合函数，以及DISTINCT，和group by的字段名</p>
<p><del>在pg中group by还有一些可选的分组方式。比如 grouping sets 对多个字段分别进行分组，然后得到结果。 cube 多个字段进行组合，然后对组合结果进行grouping sets。 rollup  过于复杂，需要时请阅读官方文档</del></p>
<h4 id="Grouping-Sets-CUBE-ROLLUP"><a href="#Grouping-Sets-CUBE-ROLLUP" class="headerlink" title="Grouping Sets,CUBE,ROLLUP"></a>Grouping Sets,CUBE,ROLLUP</h4><ul>
<li>GROUPING SETS<ul>
<li>将结果按照指定的多个字段集合group得到结果，然后将结果做个并集作为整条sql语句的结果<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">表：</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">brand | size | sales</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-------+------+-------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">Foo | L | 10</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">Foo | M | 20</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">Bar | M | 15</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">Bar | L | 5</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> brand, <span class="keyword">size</span>, <span class="keyword">sum</span>(sales) <span class="keyword">FROM</span> items_sold <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">GROUPING</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">SETS</span> ((brand), (<span class="keyword">size</span>), ());</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">结果集：</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">brand | size | sum</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-------+------+-----</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">Foo | | 30</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">Bar | | 20</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">| L | 15</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">| M | 35</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">| | 50</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">分析：</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">grouping sets 有三个字段集合1. (brand) 2. (size) 3. ()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">结果集为 group by brand   group by size  group by *  的结果集的并集</span></pre></td></tr></table></figure></li>
</ul>
</li>
<li>ROLLUP<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">ROLLUP(<span class="name">a</span>,b,c,d)=grouping sets(</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    (<span class="name">a</span>,b,c,d),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    (<span class="name">a</span>,b,c),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    (<span class="name">a</span>,b),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    (<span class="name">a</span>),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    ()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">)</span></pre></td></tr></table></figure></li>
<li>CUBE<ul>
<li>排列组合<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">CUBE(<span class="name">a</span>,b,c)=grouping sets(</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    (<span class="name">a</span>,b,c),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    (<span class="name">a</span>,c),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    (<span class="name">a</span>,b),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    (<span class="name">b</span>,c),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    (<span class="name">a</span>),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    (<span class="name">b</span>),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    (<span class="name">c</span>),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    ()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">)</span></pre></td></tr></table></figure>
<h4 id="select-列表"><a href="#select-列表" class="headerlink" title="select 列表"></a>select 列表</h4></li>
</ul>
</li>
</ul>
<ol>
<li>字段名列表，使用逗号表达式。[表名/表别名.]字段名 AS 列别名</li>
<li>DISTINCT <ul>
<li>SELECT DISTINCT select_list … 对填写的所有列做distinct</li>
<li>SELECT DISTINCT ON (expression [, expression …]) select_list … 对指定列做distince，并且指定结果集字段</li>
</ul>
</li>
<li>结果集合并<ul>
<li>query1 UNION [ALL] query2  并集</li>
<li>query1 INTERSECT [ALL] query2 交集</li>
<li>query1 EXCEPT [ALL] query2 差集<br>集合运算条件：左右有相同的列数并且对应的列的数据类型相同</li>
</ul>
</li>
</ol>
<h4 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> select_list</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> table_expression</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> sort_expression1 [<span class="keyword">ASC</span> | <span class="keyword">DESC</span>] [<span class="keyword">NULLS</span> &#123; <span class="keyword">FIRST</span> | <span class="keyword">LAST</span> &#125;]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">[, sort_expression2 [<span class="keyword">ASC</span> | <span class="keyword">DESC</span>] [<span class="keyword">NULLS</span> &#123; <span class="keyword">FIRST</span> |</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">LAST</span> &#125;] ...]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">NULLS</span> <span class="keyword">FIRST</span>| <span class="keyword">LAST</span> 选可以指定<span class="literal">null</span>值排在最前还是最后</span></pre></td></tr></table></figure>
<h4 id="limit和offset"><a href="#limit和offset" class="headerlink" title="limit和offset"></a>limit和offset</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> select_list</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> table_expression</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">[ <span class="keyword">ORDER</span> <span class="keyword">BY</span> ... ]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">[ <span class="keyword">LIMIT</span> &#123; <span class="built_in">number</span> | <span class="keyword">ALL</span> &#125; ] [ <span class="keyword">OFFSET</span> <span class="built_in">number</span> ]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">LIMIT</span> <span class="keyword">ALL</span> 相当于没有<span class="keyword">limit</span></span></pre></td></tr></table></figure>
<h4 id="值列表"><a href="#值列表" class="headerlink" title="值列表"></a>值列表</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">VALUES</span> ( <span class="selector-tag">expression</span> <span class="selector-attr">[, ...]</span> ) <span class="selector-attr">[, ...]</span></span></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="number">1</span> <span class="keyword">AS</span> column1, <span class="string">'one'</span> <span class="keyword">AS</span> column2</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="number">2</span>, <span class="string">'two'</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="number">3</span>, <span class="string">'three'</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">可以写成</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FORM</span> (<span class="keyword">VALUES</span>(<span class="number">1</span>,<span class="string">'one'</span>),(<span class="number">2</span>,<span class="string">'two'</span>),(<span class="number">3</span>,<span class="string">'three'</span>))</span></pre></td></tr></table></figure>

<h4 id="WITH-AS-子查询"><a href="#WITH-AS-子查询" class="headerlink" title="WITH AS 子查询"></a>WITH AS 子查询</h4><p>with让子查询可以直接放在最开始位置，让后续的语句可以多次复用。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> regional_sales <span class="keyword">AS</span> (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">SELECT</span> region, <span class="keyword">SUM</span>(amount) <span class="keyword">AS</span> total_sales <span class="keyword">FROM</span> orders <span class="keyword">GROUP</span> <span class="keyword">BY</span> region</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">), top_regions <span class="keyword">AS</span> (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">SELECT</span> region <span class="keyword">FROM</span> regional_sales <span class="keyword">WHERE</span> total_sales &gt; (<span class="keyword">SELECT</span> <span class="keyword">SUM</span>(total_sales)/<span class="number">10</span> <span class="keyword">FROM</span> regional_sales)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> region,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">product,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">SUM</span>(quantity) <span class="keyword">AS</span> product_units,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">SUM</span>(amount) <span class="keyword">AS</span> product_sales</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> orders</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">WHERE</span> region <span class="keyword">IN</span> (<span class="keyword">SELECT</span> region <span class="keyword">FROM</span> top_regions)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> region, product;</span></pre></td></tr></table></figure>
<p>WITH 子句中还可以写modify数据的sql</p>
<h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><table>
<thead>
<tr>
<th>Name</th>
<th>aliases</th>
<th>description</th>
</tr>
</thead>
<tbody><tr>
<td>bigint</td>
<td>int8</td>
<td>有符号8字节整数</td>
</tr>
<tr>
<td>bigserial</td>
<td>serial8</td>
<td>自增型8字节整数</td>
</tr>
<tr>
<td>bit[(n)]</td>
<td></td>
<td>固定长度位</td>
</tr>
<tr>
<td>bit varying [(n)]</td>
<td>varbit [(n)]</td>
<td>变长位</td>
</tr>
<tr>
<td>boolean</td>
<td>bool</td>
<td>布尔值</td>
</tr>
<tr>
<td>box</td>
<td></td>
<td>矩形</td>
</tr>
<tr>
<td>bytea</td>
<td></td>
<td>二进制数据</td>
</tr>
<tr>
<td>character [(n)]</td>
<td>char([n])</td>
<td>定长字符串</td>
</tr>
<tr>
<td>character varying [(n)]</td>
<td>varchar[(n)]</td>
<td>变长字符串</td>
</tr>
<tr>
<td>cidr</td>
<td></td>
<td>ipv4/ipv6网络地址</td>
</tr>
<tr>
<td>circle</td>
<td></td>
<td>圆</td>
</tr>
<tr>
<td>date</td>
<td></td>
<td>日历时间(年月日)</td>
</tr>
<tr>
<td>double precision</td>
<td>float8</td>
<td>8字节双精度浮点型</td>
</tr>
<tr>
<td>decimal</td>
<td>-</td>
<td>用户指定精度decimal(整数位数,小数位数)</td>
</tr>
<tr>
<td>numeric</td>
<td>-</td>
<td>用户指定精度numeric(整数位数,小数位数)</td>
</tr>
<tr>
<td>inet</td>
<td></td>
<td>ipv4/ipv6主机地址</td>
</tr>
<tr>
<td>integer</td>
<td>int,int4</td>
<td>有符号4字节整数</td>
</tr>
<tr>
<td>internal [(p)]</td>
<td></td>
<td>时间间隔</td>
</tr>
<tr>
<td>json</td>
<td></td>
<td>json字符串</td>
</tr>
<tr>
<td>jsonb</td>
<td></td>
<td>二进制json数据</td>
</tr>
<tr>
<td>line</td>
<td></td>
<td>平面上的线</td>
</tr>
<tr>
<td>lseg</td>
<td></td>
<td>平面上的线段</td>
</tr>
<tr>
<td>macaddr</td>
<td></td>
<td>mac地址</td>
</tr>
<tr>
<td>macaddr8</td>
<td></td>
<td>EUI-64格式的mac地址</td>
</tr>
<tr>
<td>money</td>
<td></td>
<td>货币</td>
</tr>
<tr>
<td>numeric[(p,s)]</td>
<td>decimal[(p,s)]</td>
<td>可选择精度的精确数值</td>
</tr>
<tr>
<td>path</td>
<td></td>
<td>平面几何路径</td>
</tr>
<tr>
<td>pg_lsn</td>
<td></td>
<td>pg日志序列号</td>
</tr>
<tr>
<td>point</td>
<td></td>
<td>平面几何点</td>
</tr>
<tr>
<td>polygon</td>
<td></td>
<td>平面几何封闭路径</td>
</tr>
<tr>
<td>real</td>
<td>float4</td>
<td>4 字节单精度浮点型</td>
</tr>
<tr>
<td>smallint</td>
<td>int2</td>
<td>有符号2字节整数</td>
</tr>
<tr>
<td>smallserial</td>
<td>serial2</td>
<td>自增型2字节整数</td>
</tr>
<tr>
<td>serial</td>
<td>serial4</td>
<td>自增型4字节整数</td>
</tr>
<tr>
<td>text</td>
<td></td>
<td>变长字符串</td>
</tr>
<tr>
<td>time [(p)] [with/without time zone]</td>
<td>带时区的简写为timetz</td>
<td>带/不带时区的日期</td>
</tr>
<tr>
<td>timestamp [(p)] [with/without time zone]</td>
<td>带时区的简写为timestamptz</td>
<td>带/不带时区的日期+时间</td>
</tr>
<tr>
<td>tsquery</td>
<td></td>
<td>全文检索查询</td>
</tr>
<tr>
<td>tsvector</td>
<td></td>
<td>全文检索文档</td>
</tr>
<tr>
<td>txid_snapshot</td>
<td></td>
<td>用户级别事务ID快照</td>
</tr>
<tr>
<td>uuid</td>
<td></td>
<td>通用唯一标识符</td>
</tr>
<tr>
<td>xml</td>
<td></td>
<td>xml字符串数据</td>
</tr>
</tbody></table>
<h4 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h4><ul>
<li>数值<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="literal">Infinity</span>    正无穷</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">-<span class="literal">Infinity</span>   负无穷</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="literal">NaN</span>         非数，计算机不能表示的数</span></pre></td></tr></table></figure></li>
<li>时间<ul>
<li>timestamp [(p)] [without time zone]</li>
<li>timestamp [(p)] with time zone</li>
<li>date </li>
<li>time [(p)] [without time zone]</li>
<li>time [(p)] with time zone</li>
<li>interval [fields] [(p)] 用于指定时间间隔<figure class="highlight ruleslanguage"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">精度 p = <span class="number">0</span>~<span class="number">6</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">interval的fields字段如下</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">YEAR</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">MONTH</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">DAY</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">HOUR</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">MINUTE</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">SECOND</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">YEAR</span> <span class="keyword">TO</span> <span class="keyword">MONTH</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">DAY</span> <span class="keyword">TO</span> <span class="keyword">HOUR</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">DAY</span> <span class="keyword">TO</span> <span class="keyword">MINUTE</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">DAY</span> <span class="keyword">TO</span> <span class="keyword">SECOND</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">HOUR</span> <span class="keyword">TO</span> <span class="keyword">MINUTE</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">HOUR</span> <span class="keyword">TO</span> <span class="keyword">SECOND</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">MINUTE</span> <span class="keyword">TO</span> <span class="keyword">SECOND</span></span></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<ul>
<li>注意，在指定了精度之后，必须将时间信息指定到秒，因为时间精度是在秒基础上做的精度</li>
</ul>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">time =&gt;  时分秒</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">date =&gt; 年月日</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">timestamp =&gt; 年月日 时分秒</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">比较简单的时区表示方法 +、-数字</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="number">2019</span>=<span class="number">07</span><span class="number">-26</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">00</span> +<span class="number">8</span></span></pre></td></tr></table></figure>
<p>特殊值<br>符号 | 可用于类型 | 含义<br>— | — | —<br>epoch | timestamp，date | 1970-01-01 00:00:00 (unix元年)<br>infinity | date,timestamp | 和正无穷含义相似，表示大于所有时间的时间</p>
<ul>
<li><p>infinity | date,timestamp | 表示小于所有时间的时间<br>now | date,time,timestamp | 当前时间<br>today | date,timestamp | 今日午夜<br>tomorrow | date,timestamp | 明日午夜<br>yesterday | date,timestamp | 昨日午夜<br>allballs | time | 00:00:00.00 UTC</p>
</li>
<li><p>布尔类型</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">表示<span class="literal">true</span>的值有</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="string">'t'</span> <span class="string">'true'</span> <span class="string">'y'</span> <span class="string">'yes'</span> <span class="string">'on'</span> <span class="string">'1'</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">表示<span class="literal">false</span>的值有</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="string">'f'</span> <span class="string">'false'</span> <span class="string">'n'</span> <span class="string">'no'</span> <span class="string">'off'</span> <span class="string">'0'</span></span></pre></td></tr></table></figure>
</li>
<li><p>枚举类型</p>
</li>
</ul>
<ol>
<li>声明<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">CREATE<span class="built_in"> TYPE </span>名字 AS ENUM (值<span class="built_in">..</span>.);</span></pre></td></tr></table></figure></li>
<li>使用<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> A1(</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    col1 <span class="type">integer</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    col2 枚举类型名</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">插入的时候就只能填定义的枚举类型的值了</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">WHERE</span>的时候就不能只简单的使用=了，因为=不能适用于自定义类型，只有将自定义类型转换成 数据库内部的类型</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">所以<span class="keyword">where</span>的是时候可以写成</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">WHERE</span> a1.col2::<span class="type">text</span> == a2.col2::<span class="type">text</span></span></pre></td></tr></table></figure>
通过ALTER TYPE可以再往enum类型增加值，但是不能减，也不能更改里面的顺序，所以要修改的话只有删除，然后重新创建</li>
</ol>
<ul>
<li><p>位类型<br>bit(n)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">test</span> (a <span class="built_in">BIT</span>(<span class="number">3</span>), b <span class="built_in">BIT</span> <span class="built_in">VARYING</span>(<span class="number">5</span>));</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">test</span> <span class="keyword">VALUES</span> (B<span class="string">'101'</span>, B<span class="string">'00'</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">test</span> <span class="keyword">VALUES</span> (B<span class="string">'10'</span>, B<span class="string">'101'</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">ERROR: bit string length 2 does not match type bit(3)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">test</span> <span class="keyword">VALUES</span> (B<span class="string">'10'</span>::<span class="built_in">bit</span>(<span class="number">3</span>), B<span class="string">'101'</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">test</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">a | b</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-----+-----</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">101 | 00</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">100 | 101</span></pre></td></tr></table></figure>
</li>
<li><p>全文搜索类型</p>
<ul>
<li>tsvector   分词并排序类型</li>
<li>tsquery   </li>
</ul>
</li>
<li><p>UUID</p>
</li>
<li><p>XML</p>
<ul>
<li>如果需要xml类型的支持，需要在编译是指定–with-libxml 参数，否则默认不支持</li>
</ul>
</li>
<li><p>JSON</p>
<ul>
<li>分为json和jsonb类型，两种使用上没有什么区别，只是效率上的。json只是将输入作为字符串存在数据库，而jsonb则将输入解析完然后以二进制存储，所以在查询的时候，就不会再次解析。</li>
<li>jsonb上可以对其中的字段做索引</li>
</ul>
</li>
<li><p>数组</p>
<ul>
<li>创建数组类型<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> a(</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    x <span class="built_in">text</span>[][], <span class="comment">-- 二维</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    y <span class="built_in">integer</span>[] <span class="comment">-- 一维</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">);</span></pre></td></tr></table></figure></li>
<li>输入<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">'&#123;&#123;<span class="string">"xxx"</span>,<span class="string">"xxxx"</span>&#125;&#125;','&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;'</span></pre></td></tr></table></figure></li>
<li>访问 同程序语言一样通过下标访问，下标从0开始。同时还可以像程序语言一样做切片</li>
</ul>
</li>
<li><p>复合类型【用起来很复杂】</p>
<ul>
<li>创建。 和程序中结构体的定义差不多<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TYPE</span> 类型名 <span class="keyword">AS</span> (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    字段名 类型,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    ....</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">);</span></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建类型</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TYPE</span> inventory_item <span class="keyword">AS</span> (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">name</span> <span class="built_in">text</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    supplier_id <span class="built_in">integer</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    price <span class="built_in">numeric</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建表</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> on_hand (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    item inventory_item,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">count</span> <span class="built_in">integer</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 插入数据</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> on_hand <span class="keyword">VALUES</span> (<span class="keyword">ROW</span>(<span class="string">'fuzzy dice'</span>, <span class="number">42</span>, <span class="number">1.99</span>), <span class="number">1000</span>);</span></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>Range类型<br>postgres内建了一些range类型 所有的都是左闭右开区间</p>
<ul>
<li>int4range (start,end,[‘区间类型’])     int4区间</li>
<li>int8range (start,end,[‘区间类型’])     int8 区间</li>
<li>numrange (start,end,[‘区间类型’])      数字区间</li>
<li>tsrange (start,end,[‘区间类型’])       时间戳区间</li>
<li>tstzrange (start,end,[‘区间类型’])     带time zone的时间戳区间</li>
<li>daterange (start,end,[‘区间类型’])     日期区间<br>区间类型：</li>
<li>(] [] [) () 对应数学上的区间符号</li>
</ul>
</li>
</ul>
<h3 id="function和操作符"><a href="#function和操作符" class="headerlink" title="function和操作符"></a>function和操作符</h3><h4 id="操作符"><a href="#操作符" class="headerlink" title="操作符"></a>操作符</h4><pre><code>- AND OR NOT
- &gt;,&lt;, &gt;=, &lt;=, =, &lt;&gt;, !=
- BETWEEN, NOT BETWEEN, IS NULL, IS NOT NULL, IS TRUE, IS NOT TRUE, IS UNKNOWN, IS NOT UNKNOWN
- + - * / % ^(次方) |/(平方根) ||/(立方根) !(阶乘) @(绝对值) &amp; | # ~  &lt;&lt; &gt;&gt;(位操作) </code></pre><h4 id="function"><a href="#function" class="headerlink" title="function"></a>function</h4><ul>
<li>abs(x) 绝对值</li>
<li>cbrt(x) 立方根</li>
<li>ceil(x) 取下整</li>
<li>degrees(x) 弧度转度数</li>
<li>div(y,x)  除</li>
<li>exp(x)  e^x</li>
<li>floor(x)  取上整</li>
<li>ln(x)     对数log(x,e)</li>
<li>log(x)    log(x,10)</li>
<li>log(x,y)</li>
<li>mod(y,x)  取模</li>
<li>pi()      圆周率</li>
<li>power(x,y)    x^y</li>
<li>radians(x)    度数转弧度</li>
<li>round(x,精度)      四舍五入</li>
<li>trunc(x)          截去小数</li>
<li>trunc(x,精度)        保留多少位小数</li>
<li>random()      返回0.0-1.0的随机数</li>
<li>setseed(x)    设置随机种子</li>
<li>三角函数…</li>
</ul>
<h4 id="字符串函数"><a href="#字符串函数" class="headerlink" title="字符串函数"></a>字符串函数</h4><table>
<thead>
<tr>
<th>function</th>
<th>返回值</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>s1</td>
<td></td>
<td>s2</td>
</tr>
<tr>
<td>s1</td>
<td></td>
<td>非字符串</td>
</tr>
<tr>
<td>bit_length(s)</td>
<td>int</td>
<td>字符串位长度</td>
</tr>
<tr>
<td>char_length(s)</td>
<td>int</td>
<td>字符数</td>
</tr>
<tr>
<td>lower(s)</td>
<td>text</td>
<td>转小写</td>
</tr>
<tr>
<td>upper(s)</td>
<td>text</td>
<td>大写</td>
</tr>
<tr>
<td>position(sub in str)</td>
<td>int</td>
<td>sub在str中的位置</td>
</tr>
<tr>
<td>substring(str from x for y)</td>
<td>text</td>
<td>截取[x,y)的字符串</td>
</tr>
<tr>
<td>substring(str form 模式 for 转义符号)</td>
<td>text</td>
<td>支持模式的截取</td>
</tr>
<tr>
<td>trim(方向,’字符集合’ from str)</td>
<td>text</td>
<td>移除str两端存在 字符集合中的字符</td>
</tr>
<tr>
<td>ascii(s)</td>
<td>int</td>
<td>字符转ascii</td>
</tr>
<tr>
<td>btrim(s,sub)</td>
<td>text</td>
<td>移除s两端 sub子串</td>
</tr>
<tr>
<td>chr(int)</td>
<td>text</td>
<td>ascii 转 字符</td>
</tr>
<tr>
<td>concat(s,s1,s2…)</td>
<td>text</td>
<td>字符串拼接</td>
</tr>
<tr>
<td>concat_ws(分隔符,s1,s2…)</td>
<td>text</td>
<td>字符串之间的拼接连接符</td>
</tr>
<tr>
<td>format(fmt,….)</td>
<td>text</td>
<td>字符串格式化，和c中的printf函数参数一样</td>
</tr>
</tbody></table>
<ul>
<li>模式匹配<ul>
<li>LIKE _单个字符 %任意多个字符</li>
<li>正则 字段 SMALLAR TO ‘正则’  这里的正则支持得还是比较全面的</li>
</ul>
</li>
</ul>
<h4 id="格式化函数"><a href="#格式化函数" class="headerlink" title="格式化函数"></a>格式化函数</h4><ul>
<li>to_char(timestamp,fmt)</li>
<li>to_char(interval,fmt)</li>
<li>to_char(int,fmt)</li>
<li>to_date(text,)</li>
<li>【后面补上】</li>
</ul>
<h4 id="时间函数"><a href="#时间函数" class="headerlink" title="时间函数"></a>时间函数</h4><h4 id="枚举函数"><a href="#枚举函数" class="headerlink" title="枚举函数"></a>枚举函数</h4><h4 id="网络类型函数"><a href="#网络类型函数" class="headerlink" title="网络类型函数"></a>网络类型函数</h4><p>cidr，inet操作<br>操作 | 描述<br>— | —<br>&lt; &lt;= &gt; &gt;= &lt;&gt; | 和普通意义一样<br> &lt;&lt; | 判断左某个地址是否属于右某个cidr块<br> &lt;&lt;= | 同上，多一项可等</p>
<blockquote>
<blockquote>
<p>| 判断右某个地址是否属于左某个cidr块<br> &amp;&amp; | 将&lt;&lt; &gt;&gt; 结合起来，不分左右<br>~ | 按位取反<br>&amp; | 位与<br>| | 位或</p>
</blockquote>
</blockquote>
<ul>
<li><ul>
<li>| 地址加减</li>
</ul>
</li>
</ul>
<h4 id="文本搜索类型"><a href="#文本搜索类型" class="headerlink" title="文本搜索类型"></a>文本搜索类型</h4><table>
<thead>
<tr>
<th>操作</th>
<th>描述</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>@@</td>
<td>tsvector是否匹配tsquery</td>
<td>to_tsvector(‘fat catsa ate rats’) @@ to_tsquery(‘cat &amp; rat’)  =&gt; t</td>
</tr>
<tr>
<td>@@@</td>
<td></td>
<td></td>
</tr>
<tr>
<td>||</td>
<td>连接多个tsvector</td>
<td>vector1 || vector2</td>
</tr>
<tr>
<td>&amp;&amp;</td>
<td>AND连接多个tsquery</td>
<td>tsquery1 &amp;&amp; tsquery2</td>
</tr>
<tr>
<td>||</td>
<td>OR连接多个tsquery</td>
<td>tsquery1</td>
</tr>
<tr>
<td>!!</td>
<td>NOT tsquery</td>
<td>!!tsquery</td>
</tr>
<tr>
<td>@&gt;</td>
<td>tsquery包含</td>
<td>tsquery1 @&gt; tsquery2</td>
</tr>
<tr>
<td>@&lt;</td>
<td>tsquery被包含</td>
<td></td>
</tr>
</tbody></table>
<h4 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h4><table>
<thead>
<tr>
<th>操作</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>-&gt;</td>
<td>如果右边是数字，代表取数组的某个下标的值，如果是字符串，则代表取某个对象的成员</td>
</tr>
<tr>
<td>-&gt;&gt;</td>
<td>和-&gt;操作一样，只不过是返回值不再是json表示的类型，而是直接将取得的值转成text类型</td>
</tr>
<tr>
<td>#&gt;</td>
<td>直接获取json对象的深层成员，不需要多次调用-&gt;取 。’{“a”: {“b”:{“c”:”foo”}}}’::json#&gt;’{a,b}’  =&gt; {“c”:”foo”}</td>
</tr>
<tr>
<td>#&gt;&gt;</td>
<td>将#&gt;获取的结果转换为text</td>
</tr>
</tbody></table>
<p>jsonb操作符</p>
<table>
<thead>
<tr>
<th>-</th>
<th>-</th>
</tr>
</thead>
<tbody><tr>
<td>@&gt;</td>
<td>左对象在顶层是否包含右对象的键和值</td>
</tr>
<tr>
<td>&lt;@</td>
<td>左对象在顶层是否 被 包含右对象的键和值</td>
</tr>
<tr>
<td>?</td>
<td>对象顶层是否包含某个键</td>
</tr>
<tr>
<td>?|</td>
<td>顶层对象是否包含某些键中的部分键</td>
</tr>
<tr>
<td>?&amp;</td>
<td>顶层对象是否包含所有指定的键</td>
</tr>
<tr>
<td>||</td>
<td>将两个jsonb连接成一个</td>
</tr>
<tr>
<td>- (text,text[],int)</td>
<td>删除掉对象的键，数组中的第几个元素</td>
</tr>
<tr>
<td>#-</td>
<td>删除指定path（可指定很深层次）的元素</td>
</tr>
</tbody></table>
<h4 id="条件表达式"><a href="#条件表达式" class="headerlink" title="条件表达式"></a>条件表达式</h4><ul>
<li><p>CASE</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CASE</span> <span class="keyword">WHEN</span> 条件 <span class="keyword">THEN</span> 结果</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    [<span class="keyword">WHEN</span> ...]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    [<span class="keyword">ELSE</span> 结果]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">END</span></span></pre></td></tr></table></figure></li>
<li><p>COALESCE(val1,val2,val3…)<br>从左到右，返回第一个非null的值</p>
</li>
<li><p>NULLIF(v1,v2)<br>如果v1==v2则返回null，否则返回v1</p>
</li>
<li><p>GREATEST(v1….) 、 LEAST(v1…)<br>GREATEST 返回值中的最大值<br>LEAST 返回值中的最小值</p>
</li>
</ul>
<h4 id="聚合函数-1"><a href="#聚合函数-1" class="headerlink" title="聚合函数"></a>聚合函数</h4><h4 id="窗口函数-1"><a href="#窗口函数-1" class="headerlink" title="窗口函数"></a>窗口函数</h4><h3 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h3><ul>
<li>EXISTS<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> col1 <span class="keyword">FROM</span> tab1 <span class="keyword">WHERE</span> <span class="keyword">EXISTS</span> (<span class="keyword">SELECT</span> <span class="number">1</span> <span class="keyword">FROM</span> tab2 <span class="keyword">WHERE</span> col2 = tab1.col2);</span></pre></td></tr></table></figure></li>
<li>IN</li>
<li>NOT IN</li>
<li>ANY/SOME  任意一个/其中一个</li>
<li>ALL 所有</li>
</ul>
<h3 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h3><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> TRIGGER 名字</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">BEFOR UPDATE <span class="keyword">ON</span> 表名</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">FOR</span> ECHO ROW EXECUTE <span class="function"><span class="keyword">PROCEDURE</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="function">存储过程<span class="params">()</span>;</span></span></pre></td></tr></table></figure>


<h3 id="类型转换-1"><a href="#类型转换-1" class="headerlink" title="类型转换"></a>类型转换</h3><h2 id="服务端编程"><a href="#服务端编程" class="headerlink" title="服务端编程"></a>服务端编程</h2><p>存储过程可以使用多种语言写，比如c，python等，但是要安装对应的模块才行。</p>
<h3 id="SQL-1"><a href="#SQL-1" class="headerlink" title="SQL"></a>SQL</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> 名字(<span class="built_in">integer</span>,<span class="built_in">text</span>) <span class="keyword">RETURNS</span> <span class="built_in">integer</span> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">AS</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="string">'函数体 里面的特殊字符需要转义'</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">LANGUAGE</span> <span class="keyword">SQL</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> 名字(<span class="built_in">integer</span>,<span class="built_in">text</span>) <span class="keyword">RETURNS</span> <span class="built_in">integer</span> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">AS</span> $[符号]$</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    函数体  特殊字符不需要转义了</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">$[符号]$</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">LANGUAGE</span> <span class="keyword">SQL</span>;</span></pre></td></tr></table></figure>
<ul>
<li>参数只能用于数据值，不能用作标识符(表名，列名等)</li>
<li>参数可命名也可不命名。 使用参数也可以使用 $数字 来使用位置参数，也可以直接使用参数名。 也可以使用 函数名.参数名</li>
<li>实现可变参数，将参数前加 VARIADIC  关键字并设置为一个数组就可以了，函数内部按照数组的取值方法取即可</li>
<li>参数可以设置默认值  (参数名 类型 DEFAULT 默认值)</li>
<li>返回值为一个集合。 SETOF sometype。 返回多行某类型的数据</li>
<li>返回值为一个表。TABLE(列…)</li>
<li>方法可以重载。 函数名相同，只要参数个数，类型不同就行</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">基本类型</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> one() <span class="keyword">RETURNS</span> <span class="built_in">integer</span> <span class="keyword">AS</span> $$</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">SELECT</span> <span class="number">1</span> <span class="keyword">AS</span> <span class="keyword">result</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">$$ LANGUAGE SQL;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">命名参数</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> add_em(x <span class="built_in">integer</span>, y <span class="built_in">integer</span>) <span class="keyword">RETURNS</span> <span class="built_in">integer</span> <span class="keyword">AS</span> $$</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">SELECT</span> x + y;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">$$ LANGUAGE SQL;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> add_em(<span class="number">1</span>, <span class="number">2</span>) <span class="keyword">AS</span> answer;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">位置参数</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> add_em(<span class="built_in">integer</span>, <span class="built_in">integer</span>) <span class="keyword">RETURNS</span> <span class="built_in">integer</span> <span class="keyword">AS</span> $$</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">SELECT</span> $<span class="number">1</span> + $<span class="number">2</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">$$ LANGUAGE SQL;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> add_em(<span class="number">1</span>, <span class="number">2</span>) <span class="keyword">AS</span> answer;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">使用函数名.参数名</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> tf1 (accountno <span class="built_in">integer</span>, debit <span class="built_in">numeric</span>) <span class="keyword">RETURNS</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">numeric</span> <span class="keyword">AS</span> $$</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">UPDATE</span> bank</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">SET</span> balance = balance - debit</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">WHERE</span> accountno = tf1.accountno</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">RETURNING</span> balance;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">$$ LANGUAGE SQL;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">复合类型</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> emp (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">name</span> <span class="built_in">text</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line">    salary <span class="built_in">numeric</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line">    age <span class="built_in">integer</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line">    cubicle point</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line">);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> double_salary(emp) <span class="keyword">RETURNS</span> <span class="built_in">numeric</span> <span class="keyword">AS</span> $$</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">34</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">SELECT</span> $<span class="number">1.</span>salary * <span class="number">2</span> <span class="keyword">AS</span> salary;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">35</span></pre></td><td class="code"><pre><span class="line">$$ LANGUAGE SQL;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">36</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">name</span>, double_salary(emp.*) <span class="keyword">AS</span> dream <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.cubicle ~= point <span class="string">'(2,1)'</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">37</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">38</span></pre></td><td class="code"><pre><span class="line">出参定义  (IN,OUT,INOUT)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">39</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> add_em (<span class="keyword">IN</span> x <span class="built_in">int</span>, <span class="keyword">IN</span> y <span class="built_in">int</span>, <span class="keyword">OUT</span> <span class="keyword">sum</span> <span class="built_in">int</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">40</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">AS</span> <span class="string">'SELECT x + y'</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">41</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">LANGUAGE</span> <span class="keyword">SQL</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">42</span></pre></td><td class="code"><pre><span class="line">多出参</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">43</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> sum_n_product (x <span class="built_in">int</span>, y <span class="built_in">int</span>, <span class="keyword">OUT</span> <span class="keyword">sum</span> <span class="built_in">int</span>, <span class="keyword">OUT</span> product <span class="built_in">int</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">44</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">AS</span> <span class="string">'SELECT x + y, x * y'</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">45</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">LANGUAGE</span> <span class="keyword">SQL</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">46</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">47</span></pre></td><td class="code"><pre><span class="line">可变长参数</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">48</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> mleast(VARIADIC arr <span class="built_in">numeric</span>[]) <span class="keyword">RETURNS</span> <span class="built_in">numeric</span> <span class="keyword">AS</span> $$</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">49</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">min</span>($<span class="number">1</span>[i]) <span class="keyword">FROM</span> generate_subscripts($<span class="number">1</span>, <span class="number">1</span>) g(i);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">50</span></pre></td><td class="code"><pre><span class="line">$$ LANGUAGE SQL;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">51</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> mleast(<span class="number">10</span>, <span class="number">-1</span>, <span class="number">5</span>, <span class="number">4.4</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">52</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">53</span></pre></td><td class="code"><pre><span class="line">参数带默认值</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">54</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> foo(a <span class="built_in">int</span>, b <span class="built_in">int</span> <span class="keyword">DEFAULT</span> <span class="number">2</span>, c <span class="built_in">int</span> <span class="keyword">DEFAULT</span> <span class="number">3</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">55</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">RETURNS</span> <span class="built_in">int</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">56</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">LANGUAGE</span> <span class="keyword">SQL</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">57</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">AS</span> $$</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">58</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">SELECT</span> $<span class="number">1</span> + $<span class="number">2</span> + $<span class="number">3</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">59</span></pre></td><td class="code"><pre><span class="line">$$;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">60</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> foo(<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">61</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> foo(<span class="number">10</span>, <span class="number">20</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">62</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> foo(<span class="number">10</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">63</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">64</span></pre></td><td class="code"><pre><span class="line">返回集合</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">65</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> foo (fooid <span class="built_in">int</span>, foosubid <span class="built_in">int</span>, fooname <span class="built_in">text</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">66</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> getfoo(<span class="built_in">int</span>) <span class="keyword">RETURNS</span> SETOF foo <span class="keyword">AS</span> $$</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">67</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> foo <span class="keyword">WHERE</span> fooid = $<span class="number">1</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">68</span></pre></td><td class="code"><pre><span class="line">$$ LANGUAGE SQL;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">69</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> getfoo(<span class="number">1</span>) <span class="keyword">AS</span> t1;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">70</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">71</span></pre></td><td class="code"><pre><span class="line">返回表 这种情况下不允许指定OUT，INOUT参数</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">72</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> sum_n_product_with_tab (x <span class="built_in">int</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">73</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">RETURNS</span> <span class="keyword">TABLE</span>(<span class="keyword">sum</span> <span class="built_in">int</span>, product <span class="built_in">int</span>) <span class="keyword">AS</span> $$</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">74</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">SELECT</span> $<span class="number">1</span> + tab.y, $<span class="number">1</span> * tab.y <span class="keyword">FROM</span> tab;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">75</span></pre></td><td class="code"><pre><span class="line">$$ LANGUAGE SQL;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">76</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">77</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">78</span></pre></td><td class="code"><pre><span class="line">函数重载 参数格式，类型不同</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">79</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> <span class="keyword">test</span>(<span class="built_in">int</span>, <span class="built_in">real</span>) <span class="keyword">RETURNS</span> ...</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">80</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> <span class="keyword">test</span>(<span class="built_in">smallint</span>, <span class="keyword">double</span> <span class="keyword">precision</span>) <span class="keyword">RETURNS</span> ...</span></pre></td></tr></table></figure>



<h3 id="自定义聚合函数"><a href="#自定义聚合函数" class="headerlink" title="自定义聚合函数"></a>自定义聚合函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">AGGREGATE</span> <span class="keyword">sum</span> (complex)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">(</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    sfunc = complex_add, <span class="comment">-- 函数</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    stype = complex,    <span class="comment">-- 参数类型</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    initcond = <span class="string">'(0,0)'</span>  <span class="comment">-- 初始值</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">);</span></pre></td></tr></table></figure>
<h3 id="操作符重载"><a href="#操作符重载" class="headerlink" title="操作符重载"></a>操作符重载</h3><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OPERATOR</span> + (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    leftarg = complex,  -- 左参</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    rightarg = complex, -- 右参</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">procedure</span> = <span class="title">complex_add</span>, -- 函数</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="function">    <span class="title">commutator</span> = +</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="function">);</span></span></pre></td></tr></table></figure>

<h3 id="触发器-1"><a href="#触发器-1" class="headerlink" title="触发器"></a>触发器</h3><h3 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h3><h4 id="PL-pgSQL"><a href="#PL-pgSQL" class="headerlink" title="PL/pgSQL"></a>PL/pgSQL</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> 名字(<span class="built_in">integer</span>,<span class="built_in">text</span>) <span class="keyword">RETURNS</span> <span class="built_in">integer</span> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">AS</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="string">'函数体 里面的特殊字符需要转义'</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">LANGUAGE</span> plpgsql;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> 名字(<span class="built_in">integer</span>,<span class="built_in">text</span>) <span class="keyword">RETURNS</span> <span class="built_in">integer</span> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">AS</span> $[符号]$</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    函数体  特殊字符不需要转义了</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">$[符号]$</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">LANGUAGE</span> plpgsql;</span></pre></td></tr></table></figure>
<p>函数体必须是一个block。而一个block结构如下</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&lt;&lt;label&gt;&gt;</span>]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">[<span class="keyword">DECLARE</span>  declarations]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    statements;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">END</span> [label];</span></pre></td></tr></table></figure>
<p>样例</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> somefunc() <span class="keyword">RETURNS</span> <span class="type">integer</span> <span class="keyword">AS</span> $$</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="pgsql"><span class="symbol">&lt;&lt; outerblock &gt;&gt;</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="pgsql"><span class="keyword">DECLARE</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="pgsql">    quantity <span class="type">integer</span> := <span class="number">30</span>;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="pgsql"><span class="keyword">BEGIN</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="pgsql">    <span class="keyword">RAISE</span> <span class="keyword">NOTICE</span> <span class="string">'Quantity here is %'</span>, quantity; <span class="comment">-- Prints 30</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    quantity := 50;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="pgsql"><span class="comment">--</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="pgsql"><span class="comment">-- Create a subblock</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="pgsql"><span class="comment">--</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="pgsql">    <span class="keyword">DECLARE</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="pgsql">        quantity <span class="type">integer</span> := <span class="number">80</span>;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="pgsql">    <span class="keyword">BEGIN</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="pgsql">        <span class="keyword">RAISE</span> <span class="keyword">NOTICE</span> <span class="string">'Quantity here is %'</span>, quantity; <span class="comment">-- Prints 80</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"><span class="pgsql">        <span class="keyword">RAISE</span> <span class="keyword">NOTICE</span> <span class="string">'Outer quantity here is %'</span>, outerblock.quantity; <span class="comment">-- Prints 50</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"><span class="pgsql">    <span class="keyword">END</span>;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"><span class="pgsql">    <span class="keyword">RAISE</span> <span class="keyword">NOTICE</span> <span class="string">'Quantity here is %'</span>, quantity; <span class="comment">-- Prints 50</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"><span class="pgsql">    <span class="keyword">RETURN</span> quantity;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line"><span class="pgsql"><span class="keyword">END</span>;</span></span></pre></td></tr></table></figure>
<h5 id="变量声明块"><a href="#变量声明块" class="headerlink" title="变量声明块"></a>变量声明块</h5><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">DECLARE</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    name [ CONSTANT ]<span class="built_in"> type </span>[ COLLATE collation_name ] [ <span class="keyword">NOT</span> <span class="literal">NULL</span> ] [ &#123;<span class="built_in"> DEFAULT </span>| := | = &#125; expression ];</span></pre></td></tr></table></figure>
<p>参数别名</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> sales_tax(subtotal <span class="type">real</span>) <span class="keyword">RETURNS</span> <span class="type">real</span> <span class="keyword">AS</span> $$</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="pgsql"><span class="keyword">BEGIN</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="pgsql">    <span class="keyword">RETURN</span> subtotal * <span class="number">0.06</span>;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="pgsql"><span class="keyword">END</span>;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="ruby">$$</span> <span class="keyword">LANGUAGE</span> plpgsql;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="number">2.</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> sales_tax(<span class="type">real</span>) <span class="keyword">RETURNS</span> <span class="type">real</span> <span class="keyword">AS</span> $$</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="pgsql"><span class="keyword">DECLARE</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="pgsql">    subtotal <span class="keyword">ALIAS</span> <span class="keyword">FOR</span> <span class="meta">$1</span>;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="pgsql"><span class="keyword">BEGIN</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="pgsql">    <span class="keyword">RETURN</span> subtotal * <span class="number">0.06</span>;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="pgsql"><span class="keyword">END</span>;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"><span class="ruby">$$</span> <span class="keyword">LANGUAGE</span> plpgsql;</span></pre></td></tr></table></figure>
<p>从变量会表列名复制其类型。 这很方便的声明某变量类型去接收其值。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="type">name</span> variable<span class="meta">%TYPE</span></span></pre></td></tr></table></figure>
<p>行类型</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="type">name</span> <span class="built_in">table_name</span><span class="meta">%ROWTYPE</span>;</span></pre></td></tr></table></figure>

<h5 id="表达式"><a href="#表达式" class="headerlink" title="表达式"></a>表达式</h5><ul>
<li>赋值<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">variable</span> &#123; := | = &#125; expression;</span></pre></td></tr></table></figure></li>
<li>无结果集的命令<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">PERFORM</span> query;</span></pre></td></tr></table></figure></li>
<li>动态命令<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXECUTE</span> command-<span class="keyword">string</span> [ <span class="keyword">INTO</span> [<span class="keyword">STRICT</span>] target ] [ <span class="keyword">USING</span> expression [, ... ] ];</span></pre></td></tr></table></figure></li>
<li>空表达式<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    y := x / <span class="number">0</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">EXCEPTION</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">WHEN</span> <span class="built_in">division_by_zero</span> <span class="keyword">THEN</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">NULL</span>; <span class="comment">-- ignore the error</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">END</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    y := x / <span class="number">0</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">EXCEPTION</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">WHEN</span> <span class="built_in">division_by_zero</span> <span class="keyword">THEN</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">        <span class="comment">-- ignore the error</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">END</span>;</span></pre></td></tr></table></figure>


</li>
</ul>
<h5 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h5><ul>
<li><p>return</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">RETURN</span> 表达式</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">RETURN</span> <span class="keyword">NEXT</span> expression<span class="comment">;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">RETURN</span> QUERY query<span class="comment">;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">RETURN</span> QUERY <span class="built_in">EXECUTE</span> command-<span class="built_in">string</span> [ USING expression [, ... ] ]<span class="comment">;</span></span></pre></td></tr></table></figure></li>
<li><p>if</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">IF</span> <span class="params">...</span> THEN <span class="params">...</span> END <span class="keyword">IF</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">IF</span> <span class="params">...</span> THEN <span class="params">...</span> <span class="keyword">ELSE</span> <span class="params">...</span> END <span class="keyword">IF</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">IF</span> <span class="params">...</span> THEN <span class="params">...</span> ELSIF <span class="params">...</span> THEN <span class="params">...</span> <span class="keyword">ELSE</span> <span class="params">...</span> END <span class="keyword">IF</span></span></pre></td></tr></table></figure></li>
<li><p>case</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CASE</span> search-expression</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">WHEN</span> expression [, expression [ ... ]] <span class="keyword">THEN</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">        statements</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    [ <span class="keyword">WHEN</span> expression [, expression [ ... ]] <span class="keyword">THEN</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">        statements... ]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    [ <span class="keyword">ELSE</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">        statements ]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">END</span> <span class="keyword">CASE</span>;</span></pre></td></tr></table></figure></li>
<li><p>loop</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">[ <span class="symbol">&lt;&lt;label&gt;&gt;</span> ]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">LOOP</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    statements</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">END</span> <span class="keyword">LOOP</span> [ label ];</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">退出循环</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXIT</span> [ label ] [ <span class="keyword">WHEN</span> <span class="type">boolean</span>-expression ];</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">继续循环</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CONTINUE</span> [ label ] [ <span class="keyword">WHEN</span> <span class="type">boolean</span>-expression ];</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">示例：</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">LOOP</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- some computations</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">IF</span> count &gt; <span class="number">0</span> <span class="keyword">THEN</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">EXIT</span>; <span class="comment">-- exit loop</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">END</span> <span class="keyword">IF</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">END</span> <span class="keyword">LOOP</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">LOOP</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">-- some computations</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">EXIT</span> <span class="keyword">WHEN</span> count &gt; <span class="number">0</span>; <span class="comment">-- same result as previous example</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">END</span> <span class="keyword">LOOP</span>;</span></pre></td></tr></table></figure>
</li>
<li><p>while</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">[ <span class="symbol">&lt;&lt;label&gt;&gt;</span> ]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">WHILE</span> <span class="type">boolean</span>-expression <span class="keyword">LOOP</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    statements</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">END</span> <span class="keyword">LOOP</span> [ label ];</span></pre></td></tr></table></figure></li>
<li><p>for</p>
<figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">[ &lt;&lt;<span class="keyword">label</span>&gt;&gt; ]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">FOR</span> name <span class="keyword">IN</span> [ REVERSE ] expression .. expression [ BY expression ]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">LOOP</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    statements</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">END</span> <span class="keyword">LOOP</span> [ <span class="keyword">label</span> ];</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">[ &lt;&lt;<span class="keyword">label</span>&gt;&gt; ]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">FOR</span> target <span class="keyword">IN</span> query <span class="keyword">LOOP</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    statements</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">END</span> <span class="keyword">LOOP</span> [ <span class="keyword">label</span> ];</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">Example:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">FOR</span> i <span class="keyword">IN</span> <span class="number">1</span>..<span class="number">10</span> <span class="keyword">LOOP</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- i will take on the values 1,2,3,4,5,6,7,8,9,10 within the</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">loop</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">END</span> <span class="keyword">LOOP</span>;</span></pre></td></tr></table></figure>
</li>
<li><p>遍历数组</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">[ <span class="symbol">&lt;&lt;label&gt;&gt;</span> ]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">FOREACH</span> target [ <span class="keyword">SLICE</span> number ] <span class="keyword">IN</span> <span class="keyword">ARRAY</span> expression <span class="keyword">LOOP</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    statements</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">END</span> <span class="keyword">LOOP</span> [ label ];</span></pre></td></tr></table></figure>
</li>
<li><p>错误处理</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">UPDATE</span> mytab <span class="keyword">SET</span> firstname = <span class="string">'Joe'</span> <span class="keyword">WHERE</span> lastname = <span class="string">'Jones'</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    x := x + <span class="number">1</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    y := x / <span class="number">0</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">EXCEPTION</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">WHEN</span> <span class="built_in">division_by_zero</span> <span class="keyword">THEN</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">RAISE</span> <span class="keyword">NOTICE</span> <span class="string">'caught division_by_zero'</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">RETURN</span> x;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">END</span>;</span></pre></td></tr></table></figure>

</li>
</ul>
<h5 id="游标"><a href="#游标" class="headerlink" title="游标"></a>游标</h5><ol>
<li>声明</li>
<li>打开</li>
<li>使用</li>
<li>关闭<figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">1. 声明</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">name [ [ NO ] SCROLL ] CURSOR [ ( arguments ) ] FOR query;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">2.打开</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">OPEN unbound_cursorvar [ [ NO ] SCROLL ] FOR query;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">OPEN unbound_cursorvar [ [ NO ] SCROLL ] FOR EXECUTE query_string [ USING expression [, ... ] ];</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">OPEN bound_cursorvar [ ( [ argument_name := ] argument_value [, ...] ) ];</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">3. 使用</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">FETCH [ direction &#123; <span class="meta">FROM</span> | <span class="meta">IN</span> &#125; ] cursor <span class="meta">INTO</span> target;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">MOVE [ direction &#123; <span class="meta">FROM</span> | <span class="meta">IN</span> &#125; ] cursor;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="meta">UPDATE</span> <span class="meta">table</span> <span class="meta">SET</span> ... <span class="meta">WHERE</span> CURRENT OF cursor;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="meta">DELETE</span> <span class="meta">FROM</span> <span class="meta">table</span> <span class="meta">WHERE</span> CURRENT OF cursor;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">4. 关闭</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">CLOSE curs1;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">Example:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">DECLARE</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">    curs1 refcursor;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">    curs2 CURSOR FOR <span class="meta">SELECT</span> <span class="comment">* FROM tenk1;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">    curs3 CURSOR (<span class="meta">key</span> integer) FOR <span class="meta">SELECT</span> <span class="comment">* FROM tenk1 WHERE</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line"><span class="comment">unique1 = key;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">OPEN curs1 FOR <span class="meta">SELECT</span> <span class="comment">* FROM foo WHERE key = mykey;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line">OPEN curs1 FOR EXECUTE <span class="meta">format</span>(<span class="string">'SELECT * FROM %I WHERE col1 = $1'</span>,tabname) USING keyvalue;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line">OPEN curs2;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line">OPEN curs3(42);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line">OPEN curs3(<span class="meta">key</span> := 42);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">34</span></pre></td><td class="code"><pre><span class="line">FETCH curs1 <span class="meta">INTO</span> rowvar;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">35</span></pre></td><td class="code"><pre><span class="line">FETCH curs2 <span class="meta">INTO</span> foo, bar, baz;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">36</span></pre></td><td class="code"><pre><span class="line">FETCH LAST <span class="meta">FROM</span> curs3 <span class="meta">INTO</span> <span class="meta">x</span>, y;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">37</span></pre></td><td class="code"><pre><span class="line">FETCH RELATIVE -2 <span class="meta">FROM</span> curs4 <span class="meta">INTO</span> <span class="meta">x</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">38</span></pre></td><td class="code"><pre><span class="line">MOVE curs1;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">39</span></pre></td><td class="code"><pre><span class="line">MOVE LAST <span class="meta">FROM</span> curs3;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">40</span></pre></td><td class="code"><pre><span class="line">MOVE RELATIVE -2 <span class="meta">FROM</span> curs4;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">41</span></pre></td><td class="code"><pre><span class="line">MOVE FORWARD 2 <span class="meta">FROM</span> curs4;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">42</span></pre></td><td class="code"><pre><span class="line"><span class="meta">UPDATE</span> foo <span class="meta">SET</span> dataval = myval <span class="meta">WHERE</span> CURRENT OF curs1;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">43</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">44</span></pre></td><td class="code"><pre><span class="line">[ &lt;&lt;<span class="meta">label</span>&gt;&gt; ]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">45</span></pre></td><td class="code"><pre><span class="line">FOR recordvar <span class="meta">IN</span> bound_cursorvar [ ( [ argument_name:= ] argument_value [, ...] ) ] LOOP</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">46</span></pre></td><td class="code"><pre><span class="line">    statements</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">47</span></pre></td><td class="code"><pre><span class="line"><span class="meta">END</span> LOOP [ <span class="meta">label</span> ];</span></pre></td></tr></table></figure>
</li>
</ol>
<ul>
<li><p>返回游标   refcursor 表示游标类型</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> reffunc(<span class="type">refcursor</span>) <span class="keyword">RETURNS</span> <span class="type">refcursor</span> <span class="keyword">AS</span> <span class="string">'</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="string">BEGIN</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="string">    OPEN $1 FOR SELECT col FROM test;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="string">    RETURN $1;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="string">END;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="string">'</span> <span class="keyword">LANGUAGE</span> plpgsql;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">SELECT</span> reffunc(<span class="string">'funccursor'</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">FETCH</span> <span class="keyword">ALL</span> <span class="keyword">IN</span> funccursor;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">COMMIT</span>;</span></pre></td></tr></table></figure>
</li>
<li><p>错误信息</p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="symbol">RAISE</span> [ level ] <span class="string">'format'</span> [, expression [, ... ]] [ <span class="symbol">USING</span> option = expression [, ... ] ];</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="symbol">RAISE</span> [ level ] condition_name [ <span class="symbol">USING</span> option = expression [, ... ] ];</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="symbol">RAISE</span> [ level ] <span class="symbol">SQLSTATE</span> <span class="string">'sqlstate'</span> [ <span class="symbol">USING</span> option = expression [, ... ] ];</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="symbol">RAISE</span> [ level ] <span class="symbol">USING</span> option = expression [, ... ];</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="symbol">RAISE</span> ;</span></pre></td></tr></table></figure>





</li>
</ul>

    </div>
    
    <div class="post-footer">
        <div>
            
            转载声明：
            商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="" target="_blank">Snippet</a>
            
            
        </div>
        <div>
            
        </div>
    </div>
</article>
<div class="article-nav prev-next-wrap clearfix">
    
    <a href="../../../../06/code/golang/base/type/" class="pre-post btn btn-default" title='Type 类型'>
        <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">上一篇</span>
        <span class="hidden-xs">
            Type 类型</span>
    </a>
    
    
    <a href="../../../life/audit/%E5%9C%A8%E7%88%B1%E6%83%85%E9%87%8C%E5%8F%96%E6%9A%96/" class="next-post btn btn-default" title='在爱情里取暖'>
        <span class="hidden-lg">下一篇</span>
        <span class="hidden-xs">
            在爱情里取暖</span><i class="fa fa-angle-right fa-fw"></i>
    </a>
    
</div>

<div id="comments">
    

<div id="vcomments" class="valine"></div>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="../../../../../../assets/valine.min.js"></script>
<script>
new Valine({
    av: AV,
    el: '#vcomments',
    appId: 'xOKV9J4UeQAtVkvnJC7Kq2Jn-gzGzoHsz',
    appKey: 'erIpQac4azoCmgfBB7Dl9maa',
    placeholder: '说点什么吧',
    notify: false,
    verify: true,
    avatar: 'mm',
    meta: 'nick,mail'.split(','),
    pageSize: '10',
    path: window.location.pathname,
    lang: 'zh-CN'.toLowerCase()
})
</script>


</div>

                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">
            文章目录
        </h3>
        
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#postgres-v11-官方文档阅读笔记"><span class="toc-text">postgres v11 官方文档阅读笔记</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#特点"><span class="toc-text">特点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#概览"><span class="toc-text">概览</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#安装"><span class="toc-text">安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pg架构"><span class="toc-text">pg架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#访问数据库"><span class="toc-text">访问数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建表"><span class="toc-text">创建表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#插入一条数据"><span class="toc-text">插入一条数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#查询"><span class="toc-text">查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#连接查询"><span class="toc-text">连接查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#聚合函数"><span class="toc-text">聚合函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#更新"><span class="toc-text">更新</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#删除"><span class="toc-text">删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#高级特性"><span class="toc-text">高级特性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#视图"><span class="toc-text">视图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#外键"><span class="toc-text">外键</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#事务"><span class="toc-text">事务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#窗口函数"><span class="toc-text">窗口函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#继承"><span class="toc-text">继承</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL"><span class="toc-text">SQL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#语法"><span class="toc-text">语法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#常量"><span class="toc-text">常量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#注释"><span class="toc-text">注释</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#类型转换"><span class="toc-text">类型转换</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#值表达式"><span class="toc-text">值表达式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#function的调用"><span class="toc-text">function的调用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据定义"><span class="toc-text">数据定义</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#表"><span class="toc-text">表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#默认值"><span class="toc-text">默认值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#约束"><span class="toc-text">约束</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#系统列"><span class="toc-text">系统列</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修改表结构"><span class="toc-text">修改表结构</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#增加列"><span class="toc-text">增加列</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#移除某列"><span class="toc-text">移除某列</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#添加约束"><span class="toc-text">添加约束</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#删除约束"><span class="toc-text">删除约束</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#修改列默认值"><span class="toc-text">修改列默认值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#修改列类型定义"><span class="toc-text">修改列类型定义</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#修改列名"><span class="toc-text">修改列名</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#修改表名"><span class="toc-text">修改表名</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#权限"><span class="toc-text">权限</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#schema"><span class="toc-text">schema</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#删除空schema"><span class="toc-text">删除空schema</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#强制删除schema"><span class="toc-text">强制删除schema</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#搜索路径"><span class="toc-text">搜索路径</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#继承-1"><span class="toc-text">继承</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#表的分割"><span class="toc-text">表的分割</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#依赖跟踪"><span class="toc-text">依赖跟踪</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据操纵"><span class="toc-text">数据操纵</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#插入数据"><span class="toc-text">插入数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#更新数据"><span class="toc-text">更新数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#删除数据"><span class="toc-text">删除数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#操纵数据的同时返回数据表-RETURNING"><span class="toc-text">操纵数据的同时返回数据表(RETURNING)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#查询-1"><span class="toc-text">查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#表表达式"><span class="toc-text">表表达式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#where条件句"><span class="toc-text">where条件句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#group-by-和-having"><span class="toc-text">group by 和 having</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Grouping-Sets-CUBE-ROLLUP"><span class="toc-text">Grouping Sets,CUBE,ROLLUP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#select-列表"><span class="toc-text">select 列表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#排序"><span class="toc-text">排序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#limit和offset"><span class="toc-text">limit和offset</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#值列表"><span class="toc-text">值列表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#WITH-AS-子查询"><span class="toc-text">WITH AS 子查询</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据类型"><span class="toc-text">数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#类型"><span class="toc-text">类型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#function和操作符"><span class="toc-text">function和操作符</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#操作符"><span class="toc-text">操作符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#function"><span class="toc-text">function</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#字符串函数"><span class="toc-text">字符串函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#格式化函数"><span class="toc-text">格式化函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#时间函数"><span class="toc-text">时间函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#枚举函数"><span class="toc-text">枚举函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#网络类型函数"><span class="toc-text">网络类型函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#文本搜索类型"><span class="toc-text">文本搜索类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JSON"><span class="toc-text">JSON</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#条件表达式"><span class="toc-text">条件表达式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#聚合函数-1"><span class="toc-text">聚合函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#窗口函数-1"><span class="toc-text">窗口函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#子查询"><span class="toc-text">子查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#触发器"><span class="toc-text">触发器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#类型转换-1"><span class="toc-text">类型转换</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#服务端编程"><span class="toc-text">服务端编程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL-1"><span class="toc-text">SQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义聚合函数"><span class="toc-text">自定义聚合函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#操作符重载"><span class="toc-text">操作符重载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#触发器-1"><span class="toc-text">触发器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#存储过程"><span class="toc-text">存储过程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#PL-pgSQL"><span class="toc-text">PL/pgSQL</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#变量声明块"><span class="toc-text">变量声明块</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#表达式"><span class="toc-text">表达式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#流程控制"><span class="toc-text">流程控制</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#游标"><span class="toc-text">游标</span></a></li></ol></li></ol></li></ol></li></ol></li></ol>
        
    </div>
</aside>
                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>
<a id="back-to-top" class="icon-btn hide">
    <i class="fa fa-chevron-up"></i>
</a>
    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="busuanzi">
    
    访问量:
    <strong id="busuanzi_value_site_pv">
        <i class="fa fa-spinner fa-spin"></i>
    </strong>
    &nbsp; | &nbsp;
    访客数:
    <strong id="busuanzi_value_site_uv">
        <i class="fa fa-spinner fa-spin"></i>
    </strong>
    
</div>
            </div>
            <div class="col-sm-12">
                <span>Copyright &copy;
                    2017
                    
                </span> |
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a>
                </span> |
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>



<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script src="../../../../../../js/app.js?rev=@@hash"></script>
</body>
</html>